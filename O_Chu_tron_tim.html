<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="auth.js"></script>
  <title>TR√í CH∆†I √î CH·ªÆ</title>
  <style>
#header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: #f4f4f4;
  padding: 20px 0;
  z-index: 1000;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      text-align: center;
padding-top: 120px;
    }
    h1 {
      color: blue;
margin: 0;
    }

    input, button {
  margin: 3px;
  padding: 5px 8px;
  font-size: 14px;
  line-height: 1.2;
}
input[type="number"] {
  width: 70px;
}
    #grid {
      display: grid;
      grid-template-columns: repeat(15, 30px);
      justify-content: center;
      margin-top: 0px;
    }
    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #aaa;
      text-transform: uppercase;
      font-weight: bold;
      text-align: center;
      line-height: 30px;
      background: white;
      cursor: pointer;
      user-select: none;
    }
    .found { 
background-color: blue !important; 
color: white !important;
  font-weight: bold;}
    .wrong { background-color: #f5a2a2 !important; }
    .disabled { pointer-events: none; opacity: 0.6; }
    #questionPromptDisplay {
      color: #0056b3;
      font-size: 22px;
      font-weight: bold;
      margin-top: 15px;
    }
    #instructions {
  margin-top: 10px;
  font-size: 20px;
  max-width: 900px;  /* ƒê·∫∑t ƒë·ªô r·ªông t·ªëi ƒëa ƒë·ªÉ ph√π h·ª£p v·ªõi b·ªë c·ª•c */
  width: 100%; /* Chi·ªÅu r·ªông c·ªßa ph·∫ßn t·ª≠ s·∫Ω b·∫±ng 100% chi·ªÅu r·ªông c·ªßa b·ªë c·ª•c ch·ª©a */
  text-align: left; /* CƒÉn ch·ªânh ch·ªØ tr√°i */
  margin: 0 auto; /* Canh gi·ªØa */
  word-wrap: break-word; /* ƒê·∫£m b·∫£o ch·ªØ kh√¥ng b·ªã tr√†n ra ngo√†i */
}

#instructions span {
  font-style: italic;
  display: block;
}
    .control-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    #result {
      font-size: 18px;
      margin-top: 10px;
    }

#gridWrapper {
  max-height: 500px; /* Chi·ªÅu cao t·ªëi ƒëa cho khung cu·ªôn */
  overflow-y: auto;
  margin-top: 20px;
  border: 2px solid #ccc;
  padding: 10px;
  background: #fff;
}

#helpToggle {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1100;
  padding: 5px 10px;
  font-size: 14px;
  background: #0056b3;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

#helpBox {
  position: fixed;
  top: 200px;
  left: 10px;
  width: 250px;
  max-height: 400px;
  overflow-y: auto;
  background: #fff;
  border: 2px solid #ccc;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  z-index: 1001;
  font-size: 14px;
  text-align: left;
}

#helpBox h3 {
  margin-top: 0;
  font-size: 16px;
}

.hidden {
  display: none;
}


#editToggle {
  position: fixed;
  top: 50px; /* D∆∞·ªõi n√∫t H∆Ø·ªöNG D·∫™N (top: 10px) */
  left: 10px;
  z-index: 1100;
  padding: 5px 10px;
  font-size: 14px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}


/* Th√™m m·ªôt l·ªõp ƒë·ªÉ thay ƒë·ªïi m√†u s·∫Øc khi √¥ ƒë∆∞·ª£c ch·ªçn */
.selected-cell {
  background-color: black;
  color: white;
}

/* Th√™m l·ªõp ƒë·ªÉ t√¥ m√†u √¥ ch∆∞a t√¨m ƒë∆∞·ª£c */
.highlighted {
  background-color: blue;
  color: white;
}


.missed {
  background-color: pink !important;
  color: black !important;
}

.unfound {
  background-color: pink !important;
  color: black !important;
}
@keyframes blinkColor {
  0% { background-color: blue; }
  50% { background-color: red; }
  100% { background-color: blue; }
}
.blinking {
  font-weight: bold;
  color: #fff;
  border: 2px solid #3399ff;
  border-radius: 6px;
  transition: background-color 0.5s ease;
animation: blinkColor 1s infinite;
}




  </style>
</head>
<body>
<div id="header">
<button id="helpToggle">‚ùì XEM H∆Ø·ªöNG D·∫™N</button>
<button id="editToggle" onclick="openSoanTuKhoa()">üìù  SO·∫†N T·ª™ KH√ìA</button>

<div id="helpBox" class="hidden">
  <h3>H∆∞·ªõng d·∫´n</h3>
  <ul>
    <li>Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i.</li>
    <li>Ch·ªçn kho·∫£ng th·ªùi gian ch∆°i.</li>
    <li>Nh·∫•n üìÇ M·ªû CH·ª¶ ƒê·ªÄ ƒë·ªÉ t·∫£i b·∫£ng √¥ ch·ªØ.</li>
    <li>Nh·∫•n ‚ñ∂ B·∫ÆT ƒê·∫¶U CH∆†I ƒë·ªÉ ch∆°i.</li>
    <li>Nh·∫•p v√†o c√°c √¥ ƒë·ªÉ ch·ªçn t·ª´, r·ªìi nh·∫•n ‚úî KI·ªÇM TRA T·ª™ ƒë·ªÉ x√°c nh·∫≠n.</li>
    <li>Ch√∫c b·∫°n ƒë·∫°t k·∫øt qu·∫£ cao!</li>
  </ul>
</div>

  <h1>TR√í CH∆†I "AI TINH M·∫ÆT" - √î CH·ªÆ TR·ªêN T√åM</h1>
  <div class="control-row">
    <input type="text" id="playerName" placeholder="T√™n ng∆∞·ªùi ch∆°i" /> 
<label style="display: flex; align-items: center;">Th·ªùi gian ch∆°i (s):
  <input type="number" id="countdownInput" value="180" min="10" max="3600" title="Th·ªùi gian ƒë·∫øm ng∆∞·ª£c (gi√¢y)" /></label>
    <!-- N√∫t M·ªû CH·ª¶ ƒê·ªÄ -->
<button onclick="triggerFileInput()">üìÇ M·ªû CH·ª¶ ƒê·ªÄ</button>
<input type="file" id="fileInput" accept=".html" style="display: none;" onchange="loadChuDeFromFile()" />

<button onclick="loadChuDeFromFile()"> ‚ñ∂ B·∫ÆT ƒê·∫¶U CH∆†I</button>
  
        <button onclick="checkResult()" id="checkButton">‚úî KI·ªÇM TRA T·ª™</button>
    <button onclick="resetGame()">üîÅ CH∆†I L·∫†I</button>
  
</div>
  <div id="questionPromptDisplay"></div>

  
  <div id="timer">‚è≥ Th·ªùi gian: 0 gi√¢y</div>
  <div id="gridWrapper"> <div id="grid"></div></div>
  <div id="result"></div>

  <audio id="correctSound" src="correct.mp3"></audio>

  <script>
    const SIZE = 15;
    let board = Array.from({ length: SIZE }, () => Array(SIZE).fill(""));
    let foundWords = [];
    let countdown = 0;
    let interval;
    let gameOver = true;
    let words = [];
let blinkInterval = null;
let blinkColors = ["#007bff", "#dc3545"]; // Xanh d∆∞∆°ng ‚Üî ƒê·ªè
let blinkIndex = 0;


    function randomChar() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return chars.charAt(Math.floor(Math.random() * chars.length));
    }

    function placeWord(word) {
      word = word.toUpperCase();
      const directions = [[0, 1], [1, 0], [1, 1], [-1, 1]];
      let placed = false;
      for (let attempt = 0; attempt < 100 && !placed; attempt++) {
        const dir = directions[Math.floor(Math.random() * directions.length)];
        const row = Math.floor(Math.random() * SIZE);
        const col = Math.floor(Math.random() * SIZE);
        let r = row, c = col, fits = true;
        for (let ch of word) {
          if (r < 0 || r >= SIZE || c < 0 || c >= SIZE || (board[r][c] && board[r][c] !== ch)) {
            fits = false; break;
          }
          r += dir[0]; c += dir[1];
        }
        if (fits) {
          r = row; c = col;
          for (let ch of word) {
            board[r][c] = ch;
            r += dir[0]; c += dir[1];
          }
          placed = true;
        }
      }
    }

    function fillBoard() {
      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          if (!board[r][c]) board[r][c] = randomChar();
        }
      }
    }

    function renderBoard() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.textContent = board[r][c];
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.onclick = () => toggleCell(cell);
          grid.appendChild(cell);
        }
      }
    }

    // H√†m ƒë·ªÉ chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i √¥ khi ng∆∞·ªùi ch∆°i nh·∫•p v√†o √¥
function toggleCell(cell) {
  if (gameOver || cell.classList.contains("found")) return;

  // Ki·ªÉm tra n·∫øu √¥ ƒë√£ ƒë∆∞·ª£c ch·ªçn, th√¨ b·ªè ch·ªçn
  if (cell.classList.contains("selected-cell")) {
    cell.classList.remove("selected-cell");
  } else {
    // N·∫øu ch∆∞a ch·ªçn, th√™m l·ªõp "selected-cell" ƒë·ªÉ thay ƒë·ªïi m√†u s·∫Øc
    cell.classList.add("selected-cell");
  }
}

function toggleCell(cell) {
  if (gameOver) return;

  // Cho ph√©p ch·ªçn/deselect m·ªçi √¥, k·ªÉ c·∫£ ƒë√£ "found"
  if (cell.classList.contains("selected")) {
    cell.classList.remove("selected", "selected-cell");
  } else {
    cell.classList.add("selected", "selected-cell");
  }
}



    function getSelectedWord() {
  const selected = Array.from(document.querySelectorAll(".cell.selected"));
  const sorted = selected.sort((a, b) => {
    const r1 = parseInt(a.dataset.row), c1 = parseInt(a.dataset.col);
    const r2 = parseInt(b.dataset.row), c2 = parseInt(b.dataset.col);
    if (r1 === r2) return c1 - c2;      // c√πng h√†ng -> so s√°nh c·ªôt
    if (c1 === c2) return r1 - r2;      // c√πng c·ªôt -> so s√°nh h√†ng
    return (r1 - r2) || (c1 - c2);      // n·∫øu ch√©o -> s·∫Øp theo d√≤ng tr∆∞·ªõc
  });
  return sorted.map(c => c.textContent).join("").toUpperCase();
}


    function checkResult() {
      if (gameOver) return;
      const selected = document.querySelectorAll(".cell.selected");
      const word = getSelectedWord();
      if (words.includes(word) && !foundWords.includes(word)) {
        selected.forEach(c => {
          c.classList.remove("selected");
          c.classList.add("found");
        });
        document.getElementById("correctSound").play();
        foundWords.push(word);
      } else {
        selected.forEach(c => {
          c.classList.remove("selected");
          c.classList.add("wrong");
          setTimeout(() => c.classList.remove("wrong"), 500);
        });
      }
      const player = document.getElementById("playerName").value || "NG∆Ø·ªúI CH∆†I ·∫®N DANH";
      document.getElementById("result").innerText =
        `üéâ ${player} ƒë√£ t√¨m ƒë∆∞·ª£c ${foundWords.length} t·ª´ ƒë√∫ng!`;

stopBlinking(); // d·ª´ng nh·∫•p nh√°y

const checkBtn = document.getElementById("checkButton");
clearTimeout(checkBtn.blinkTimeout);
checkBtn.blinkTimeout = setTimeout(() => {
  startBlinking(); // kh·ªüi ƒë·ªông l·∫°i sau 10s
}, 10000);

    }

    function startGame() {
  if (words.length === 0) {
    alert("‚ö† Vui l√≤ng m·ªü ch·ªß ƒë·ªÅ tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu!");
startBlinking();
    return;
  }

  clearInterval(interval);  // clear any previous interval
  gameOver = false;
  board = Array.from({ length: SIZE }, () => Array(SIZE).fill("")); // reset board
  foundWords = [];
  document.getElementById("result").innerText = "";
  document.getElementById("checkButton").classList.remove("disabled");

document.getElementById("checkButton").classList.add("blinking");
  // ‚úÖ KH·ªûI ƒê·ªòNG NH·∫§P NH√ÅY
 
 words.forEach(placeWord);  // place words on the board
  fillBoard();
  renderBoard();

  // Get the countdown time from the input
  countdown = parseInt(document.getElementById("countdownInput").value) || 180;
  document.getElementById("timer").innerText = `‚è≥ Th·ªùi gian c√≤n l·∫°i: ${countdown} gi√¢y`;

  // Start the countdown when "B·∫Øt ƒë·∫ßu" is clicked
  interval = setInterval(() => {
    countdown--;
    document.getElementById("timer").innerText = `‚è≥ Th·ªùi gian c√≤n l·∫°i: ${countdown} gi√¢y`;
    if (countdown <= 0) {
      clearInterval(interval);
      endGame();
    }
  }, 1000);
}


    function endGame() {
      gameOver = true;
      document.querySelectorAll(".cell").forEach(c => c.classList.add("disabled"));
      document.getElementById("checkButton").classList.add("disabled");
      document.getElementById("timer").innerText = "‚è∞ H·∫øt gi·ªù!";
    
// Hi·ªÉn th·ªã c√°c t·ª´ ch∆∞a ƒë∆∞·ª£c t√¨m th·∫•y v√† t√¥ m√†u c√°c √¥ t∆∞∆°ng ·ª©ng
  words.forEach(word => {
    if (!foundWords.includes(word)) {
      highlightWord(word);
    }
  });
 }

function highlightWord(word) {
  word = word.toUpperCase();
  const directions = [
    [0, 1], [1, 0], [1, 1], [-1, 1],
    [0, -1], [-1, 0], [-1, -1], [1, -1] // Th√™m ƒë·ªß 8 h∆∞·ªõng
  ];

  for (let r = 0; r < SIZE; r++) {
    for (let c = 0; c < SIZE; c++) {
      for (let dir of directions) {
        let rTemp = r, cTemp = c;
        let matched = true;
        for (let i = 0; i < word.length; i++) {
          if (
            rTemp < 0 || rTemp >= SIZE ||
            cTemp < 0 || cTemp >= SIZE ||
            board[rTemp][cTemp] !== word[i]
          ) {
            matched = false;
            break;
          }
          rTemp += dir[0];
          cTemp += dir[1];
        }
        if (matched) {
          // N·∫øu kh·ªõp, t√¥ m√†u c√°c √¥ ƒë√≥
          rTemp = r; cTemp = c;
          for (let i = 0; i < word.length; i++) {
            const cell = document.querySelector(`[data-row='${rTemp}'][data-col='${cTemp}']`);
            if (cell && !cell.classList.contains("found")) {
              cell.classList.add("unfound");
            }
            rTemp += dir[0];
            cTemp += dir[1];
          }
          return; // d·ª´ng sau khi t√¨m th·∫•y 1 v·ªã tr√≠
        }
      }
    }
  }
}



    function resetGame() {
      clearInterval(interval);
      startGame();

    }

    // K√≠ch ho·∫°t √¥ ch·ªçn file khi nh·∫•n v√†o n√∫t "M·ªû CH·ª¶ ƒê·ªÄ"
function triggerFileInput() {
  document.getElementById('fileInput').click();
}

// ƒê·ªçc v√† x·ª≠ l√Ω file sau khi ng∆∞·ªùi d√πng ch·ªçn
function loadChuDeFromFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];
  if (!file) {
    alert("‚ö† Vui l√≤ng ch·ªçn m·ªôt file ch·ªß ƒë·ªÅ.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const html = e.target.result;
    const temp = document.createElement('div');
    temp.innerHTML = html;

    const tieuDe = temp.querySelector('#tieude');
    const tuKhoa = temp.querySelector('#tukhoa');

    if (tieuDe && tuKhoa) {
      document.getElementById('questionPromptDisplay').innerText = tieuDe.innerText.trim();

      const danhSach = tuKhoa.innerText
        .split(',')
        .map(w => w.trim().toUpperCase())
        .filter(w => w.length > 0);

      if (danhSach.length > 0) {
        words = danhSach;
        startGame(); // t·ª± ƒë·ªông b·∫Øt ƒë·∫ßu game
      } else {
        alert("‚ö† Kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a trong file.");
      }
    } else {
      alert("‚ö† File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (c·∫ßn c√≥ #tieude v√† #tukhoa).");
    }
  };

  reader.onerror = function(err) {
    console.error(err);
    alert("‚ö† Kh√¥ng th·ªÉ ƒë·ªçc file ch·ªß ƒë·ªÅ.");
  };

  reader.readAsText(file, "UTF-8");
}



document.getElementById("helpToggle").onclick = () => {
  const box = document.getElementById("helpBox");
  box.classList.toggle("hidden");
};


function openSoanTuKhoa() {
  window.open("Soan_trochoiOchu.html", "_blank");
}


function startBlinking() {
  const btn = document.getElementById("checkButton");
  btn.classList.add("blinking");
  blinkInterval = setInterval(() => {
    btn.style.backgroundColor = blinkColors[blinkIndex];
    blinkIndex = (blinkIndex + 1) % blinkColors.length;
  }, 1000);
}

function stopBlinking() {
  const btn = document.getElementById("checkButton");
  clearInterval(blinkInterval);
  btn.style.backgroundColor = blinkColors[0]; // v·ªÅ m·∫∑c ƒë·ªãnh xanh d∆∞∆°ng
}

  </script>




<!-- N√∫t to√†n m√†n h√¨nh c·ªë ƒë·ªãnh -->
<div style="
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
">
  <button onclick="openFullscreen()" style="
    padding: 10px 16px;
    font-size: 14px;
    background: #00BFFF;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
  ">üîç Xem Full m√†n h√¨nh</button>

  <button onclick="exitFullscreen()" style="
    padding: 10px 16px;
    font-size: 14px;
    background: #FF6347;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
  ">‚ùå Tho√°t Full m√†n h√¨nh</button>
</div>


<script>
function openFullscreen() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.webkitRequestFullscreen) {
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) {
    elem.msRequestFullscreen();
  }
}

function exitFullscreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  }
}
</script>


<div style="position: fixed; top: 20px; right: 20px; z-index: 1001;">
  <button onclick="window.location.href='index.html'" style="background-color: red; color: white; font-weight: bold; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
    THO√ÅT - V·ªÄ TRANG CH·ª¶
  </button>
  <script src="chao_name.js"></script>
</body>
</html>
